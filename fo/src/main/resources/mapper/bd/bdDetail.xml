<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.m2m.fo.bd.mapper.BdDetailMapper">
	
	<select id="selectDetail" parameterType="com.m2m.fo.bd.model.BdDetailVO" resultType="com.m2m.fo.bd.model.BdDetailVO">
	  /* com.m2m.fo.bd.mapper.BdDetailMapper.selectDetail */
		 SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
 		SELECT
				  BB.BID_PBLANC_ID	/*입찰공고아이디*/
				, BB.BID_STTUS_CODE	/*입찰상태코드*/
				, BB.METAL_CODE
				, (SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'METAL_CODE'  AND SUB_CODE = BB.METAL_CODE) AS METAL_CODE_NM	/*메탈구분*/
				, (SELECT CODE_DCONE FROM CO_CMMN_CD WHERE MAIN_CODE = 'METAL_CODE'  AND SUB_CODE = BB.METAL_CODE) AS METAL_CODE_EM	/*메탈구분(영어)*/
				, BB.BRAND_GROUP_CODE
				, ISNULL((SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'BRAND_GROUP_CODE'  AND SUB_CODE = BB.BRAND_GROUP_CODE),'ANY BRAND') AS BRAND_GROUP_CODE_NM	/*브랜드*/
				, BB.BRAND_GROUP_CODE
				, BB.BRAND_CODE
				, BB.ITM_SN
				, (SELECT GOODS_NM FROM IT_ITM_INFO_BAS WHERE 1=1 AND BB.ITM_SN = ITM_SN AND DELETE_AT = 'N') AS DSPY_GOODS_NM	/*아이템상품명*/
				, (SELECT DOC_FILE_REAL_COURS FROM IT_ITM_INFO_BAS IIIB JOIN CO_DOC_BAS CDB ON DOC_NO = IIIB.PC_IMAGE_ONE_SN WHERE IIIB.ITM_SN =BB.ITM_SN) AS PC_IMAGE_ONE_NM
				, BB.DSTRCT_LCLSF_CODE
				, (SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'DSTRCT_LCLSF_CODE'  AND SUB_CODE = BB.DSTRCT_LCLSF_CODE) AS DSTRCT_NM	/*권역*/
				, BB.BID_WT	/*수량*/
				, BB.PERM_WT_RATE	/*중량허용공차*/
				, BB.DELY_BEGIN_DE	/*인도기간시작*/
				, BB.DELY_END_DE	/*인도기간종료*/
				, BB.PC_APPN_BEGIN_DE	/*가격지정기간시작*/
				, BB.PC_APPN_END_DE	/*가격지정기간종료*/
				, BB.PC_APPN_MTH_CODE
				, (SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'PC_APPN_MTH_CODE' AND SUB_CODE = BB.PC_APPN_MTH_CODE) AS PC_APPN_MTH_CODE_NM /*가격지정방법코드*/				
				, BB.SETLE_CRNCY_CODE
				, (SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'SETLE_CRNCY_CODE' AND SUB_CODE = BB.SETLE_CRNCY_CODE) AS SETLE_CRNCY_CODE_NM /*결제통화코드*/				
				, BB.SETLE_MTH_CODE
				, (SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'SETLE_MTH_CODE' AND SUB_CODE = BB.SETLE_MTH_CODE) AS SETLE_MTH_CODE_NM /*결제방법코드*/				
				, BB.SETLE_PD_CODE
				, (SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'SETLE_PD_CODE' AND SUB_CODE = BB.SETLE_PD_CODE) AS SETLE_PD_CODE_NM/*결제기간코드*/				
				, BB.ETC_CN	/*기타코멘트*/       
		FROM BD_BID_BAS BB
		WHERE 1=1
			AND BB.BID_PBLANC_ID 			=	#{bidPblancId}
			AND BB.DSPY_AT 					=	'Y'						/* 전시 여부 */
			AND BB.PBLANC_CANCL_AT			=	'N'						/* 공고 취소 여부 */
			AND BB.DELETE_AT 				=	'N'						/* 삭제 여부 */
	</select>
	
	<select id="selectbdDelyCndList" parameterType="com.m2m.fo.bd.model.BdDetailVO" resultType="com.m2m.fo.bd.model.BdDetailVO">
	  /* com.m2m.fo.bd.mapper.BdDetailMapper.selectbdDelyCndList */
      SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
      	SELECT 
			CODE_DCONE,
			CODE_DCTWO
	 	 FROM CO_CMMN_CD 
		 WHERE 1=1
		   AND MAIN_CODE = 'BID_DELY_CND'
		   AND SUB_CODE != '@'
		   AND DELETE_AT = 'N'
           AND CODE_DCONE = #{dstrctLclsfCode}
		 ORDER BY SUB_CODE 
    </select>
    
    <select id="selectBddpr" parameterType="com.m2m.fo.bd.model.BdDetailVO" resultType="com.m2m.fo.bd.model.BdBddprVO">
	  /* com.m2m.fo.bd.mapper.BdDetailMapper.selectBddpr */
		 SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
		SELECT
			 BID_ENTRPS_NO	/*입찰업체 번호*/
			,BID_PBLANC_ID	/*입찰공고 아이디*/
			,BDDPR_DT	/*투찰일시*/
			,DELY_CND_STDR_PC	/*인도조건 기준가격*/
			,CNVRS_PREMIUM_AMOUNT	/*전환 프리미엄 금액*/
			,BDDPR_PREMIUM_PC	/*투찰 프리미엄 가격*/
			,( SELECT CODE_DCTWO
			   FROM CO_CMMN_CD CCC
			   WHERE 1=1
			   AND CCC.MAIN_CODE = 'BID_DELY_CND'
			   AND CCC.SUB_CODE != '@'
			   AND CCC.DELETE_AT = 'N'
			   AND CCC.CODE_DCONE = BBD.DELY_CND_CODE ) AS DELY_CND_CODE_NM
		FROM	
			BD_BDDPR_DTL BBD
		WHERE 1=1
		AND BID_ENTRPS_NO = #{bidEntrpsNo}
		AND BID_PBLANC_ID = #{bidPblancId}
		AND CANCL_AT = 'N'	/*취소여부*/
		AND DELETE_AT = 'N' /*삭제여부*/
	</select>
    
    <select id="passwordCheck" parameterType="com.m2m.fo.bd.model.BdDetailVO" resultType="String">
	  /* com.m2m.fo.bd.mapper.BdDetailMapper.passwordCheck */
      SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
      	SELECT 
			BID_ENTRPS_NO
		FROM BD_ENTRPS_INFO_BAS
		WHERE 1=1
		AND BID_ENTRPS_NO = #{bidEntrpsNo}
		AND BID_MBER_SECRET_NO = #{bidMberSecretNo}
    </select>
    
    <insert id="insertBdBddpr" parameterType="com.m2m.fo.bd.model.BdBddprVO" >
	  /* com.m2m.fo.bd.mapper.BdDetailMapper.insertBdBddpr */
	  SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
		INSERT INTO BD_BDDPR_DTL                            /* 입찰 공고 등록 기본           	*/
		     ( 
		       BID_ENTRPS_NO									   /* 입찰 업체 번호               		*/
		     , BID_PBLANC_ID                                        /* 입찰 공고 아이디              	*/
		     , DELY_CND_CODE                                      /* 인도 조건 코드               	*/
		     , DELY_CND_STDR_PC                                  /* 인도 조건 기준 가격           	*/
		     , CNVRS_PREMIUM_AMOUNT                        /* 전환 프리미엄 금액            	*/  
		     , BDDPR_PREMIUM_PC                                 /* 투찰 프리미엄 가격            	*/
		     , BDDPR_WT                                            	/* 투찰 중량                   		*/
		     , PARTCPTN_AGRE_AT                                  /* 참여 동의 여부               	*/
			 , BDDPR_DT                                           	/* 투찰 일시                   		*/
			 , BDDPR_NRMLT_AT                                    /* 투찰 정상 여부               	*/
			 , SCSBID_AT                                           	/* 낙찰 여부                   		*/
			 , CANCL_AT                                     	   		/* 취소 여부                   		*/
			 , DELETE_AT                            			   		/* 삭제 여부                    		*/
			 , FRST_REGISTER_ID                                    	/* 최초 등록자 아이디            	*/
			 , FRST_REGIST_DT                                      	/* 최초 등록 일시                	*/
			 , LAST_CHANGER_ID                                    /* 최종 변경자 아이디          	*/
			 , LAST_CHANGE_DT                                     /* 최종 변경 일시                	*/                               
             , PC_APPN_BEGIN_DE
             , PC_APPN_END_DE                                           
		     )
		VALUES
		     (
		       #{bidEntrpsNo}                                                                                  
		     , #{bidPblancId}
		     , #{delyCndCode}                                                                    
		     , #{delyCndStdrPc}                                                                    
		     , #{cnvrsPremiumAmount}                                                                    
		     , #{bddprPremiumPc}                                                                     
		     , #{bddprWt}                                                                      
		     , #{partcptnAgreAt}                                                                      
		     , CONVERT(CHAR(23), GETDATE(), 21)       
		     , #{bddprNrmltAt}	
		     , #{scsbidAt}
		     , #{canclAt}																				
		     , #{deleteAt}                                                                                    
		     , #{frstRegisterId}                                                                
		     , GETDATE()                                                                                  
		     , #{lastChangerId}                                               
		     , GETDATE()           
             , #{pcAppnBeginDe}
             , #{pcAppnEndDe}                                                           
		     ) 
	</insert>
	
	<select id="selectPartEntQy" parameterType="com.m2m.fo.bd.model.BdBddprVO" resultType="int">
	  /* com.m2m.fo.bd.mapper.BdDetailMapper.selectPartEntQy */
      SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
		SELECT 
			PARTCPTN_ENTRPS_QY	/*참여업체수량*/
		FROM 
			BD_BID_BAS
		WHERE 1=1
		AND BID_PBLANC_ID = #{bidPblancId}
    </select>
    
	<update id="updatePartEntQy" parameterType="com.m2m.fo.bd.model.BdBddprVO">
		/* com.m2m.fo.bd.mapper.BdDetailMapper.updatePartEntQy */
		SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
		UPDATE BD_BID_BAS
		SET
			PARTCPTN_ENTRPS_QY = #{partEntQy}
		WHERE 1=1
		AND BID_PBLANC_ID = #{bidPblancId}
	</update>
</mapper>