<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "C:\m2m_project\workspace\mybatis-3-mapper.dtd">

<mapper namespace="com.m2m.fo.bo.mapper.BoBdPblnMapper">
	<select id="boBdPblnDtl" parameterType="com.m2m.fo.bo.model.BoBdPblnVO" resultType="com.m2m.fo.bo.model.BoBdPblnVO">
		SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
        	/* com.m2m.fo.bo.mapper.BoBdPblnMapper.boBdPblnDtl */
        SELECT
              BB.BID_PBLANC_ID                                                                 /*입찰공고아이디*/
            , BB.BID_STTUS_CODE                                                                /*입찰상태코드*/
            , (SELECT CODE_DCTWO 
            	FROM CO_CMMN_CD 
            	WHERE MAIN_CODE = 'BID_STTUS_CODE' 
            	 AND SUB_CODE = BB.BID_STTUS_CODE) AS BID_STTUS                                /*입찰상태*/
            , BB.METAL_CODE                                                                    /*금속코드*/
            , (SELECT CODE_DCTWO 
            	FROM CO_CMMN_CD 
            	WHERE MAIN_CODE = 'METAL_CODE' 
            	 AND SUB_CODE = BB.METAL_CODE) AS METAL_CODE_NM                                /*메탈구분*/
            , (SELECT CODE_DCONE 
            	FROM CO_CMMN_CD 
            	WHERE MAIN_CODE = 'METAL_CODE'  
            	AND SUB_CODE = BB.METAL_CODE) AS METAL_CODE_EM                                 /*메탈구분(영어)*/
            , BB.BRAND_GROUP_CODE                                                              /*브랜드그룹코드*/ 
            , ISNULL((SELECT CODE_DCTWO 
           		FROM CO_CMMN_CD 
           		WHERE MAIN_CODE = 'BRAND_GROUP_CODE'  
           		 AND SUB_CODE = BB.BRAND_GROUP_CODE),'ANY BRAND') AS BRAND_GROUP_CODE_NM       /*브랜드*/
            , BB.BRAND_CODE                                                                    /*브랜드코드*/
            , BB.ITM_SN                                                                        /*아이템순번*/
            , (SELECT GOODS_NM
            	FROM IT_ITM_INFO_BAS 
            	WHERE 1=1 
            	 AND BB.ITM_SN = ITM_SN 
            	 AND DELETE_AT = 'N') AS DSPY_GOODS_NM                                         /*아이템상품명*/
            , BB.DSTRCT_LCLSF_CODE                                                             /*권역대분류코드*/
            , (SELECT CODE_DCTWO 
            	FROM CO_CMMN_CD 
            	WHERE MAIN_CODE = 'DSTRCT_LCLSF_CODE'  
            	 AND SUB_CODE = BB.DSTRCT_LCLSF_CODE) AS DSTRCT_NM                             /*권역*/
            , BB.BID_WT                                                                        /*입찰중량*/
            , BB.PERM_WT_RATE                                                                  /*허용중량비율*/
            , BB.DELY_BEGIN_DE                                                                 /*인도기간시작*/
            , BB.DELY_END_DE                                                                   /*인도기간종료*/
            , BB.PC_APPN_BEGIN_DE                                                              /*가격지정기간시작*/
            , BB.PC_APPN_END_DE                                                                /*가격지정기간종료*/
            , BB.PC_APPN_MTH_CODE                                                              /*가격지정방법코드*/
            , (SELECT CODE_DCTWO 
            	FROM CO_CMMN_CD 
            	WHERE MAIN_CODE = 'PC_APPN_MTH_CODE' 
            	 AND SUB_CODE = BB.PC_APPN_MTH_CODE) AS PC_APPN_MTH_CODE_NM                    /*가격지정방법*/
            ,CONCAT(
            COALESCE((SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'SETLE_CRNCY_CODE' AND SUB_CODE = BB.SETLE_CRNCY_CODE), 'N/A'),' ',
            COALESCE((SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'SETLE_MTH_CODE' AND SUB_CODE = BB.SETLE_MTH_CODE), 'N/A'),' ',
            COALESCE((SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'SETLE_PD_CODE' AND SUB_CODE = BB.SETLE_PD_CODE), 'N/A'),' '
            ) AS SETLE_CNDTN                                                                   /*결제조건*/
            , BB.ETC_CN                                                                        /*기타코멘트*/
            , BB.BDDPR_BEGIN_DT                                                                /*투찰시작일시*/
            , BB.BDDPR_END_DT                                                                  /*투찰종료일시*/
            , BB.BDDPR_CANCL_LMTT_DE                                                           /*투찰취소제한일자*/            
            , BUHS.BID_UPDT_CN                                                                 /*입찰수정내용*/
            , BUHS.BID_UPDT_RESN                                                               /*입찰수정사유*/
            , BB.DSPY_AT                                                                       /*전시여부*/
      FROM BD_BID_BAS AS BB 
      INNER JOIN BD_BID_UPDT_HST AS BUHS                                
      ON BB.BID_PBLANC_ID = BUHS.BID_PBLANC_ID
      WHERE 1=1
    <!--      AND BB.BID_PBLANC_ID          =   #{bidPblancId}                                      /*입찰공고아이디*/ -->
         AND BB.BID_PBLANC_ID          =   'TEST01-01'                                         /*입찰공고아이디*/
         AND BB.DELETE_AT              =   'N'                                                 /*삭제여부*/
	</select>

    <select id="getBoBdPblnList" parameterType="com.m2m.fo.bo.model.BoBdPblnVO" resultType="com.m2m.fo.bo.model.BoBdPblnVO">
        SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
        /* com.m2m.fo.bo.mapper.BoBdPblnMapper.getBoBdPblnList */
        SELECT
        BB.BID_PBLANC_ID --입찰공고아이디
            ,(SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'METAL_CODE' AND SUB_CODE = CAST(BB.METAL_CODE AS INT)) AS METAL_NAME -- 금속 이름
            ,(SELECT GOODS_NM FROM IT_ITM_INFO_BAS WHERE ITM_SN = CAST(BB.ITM_SN AS INT) AND DELETE_AT = 'N') AS ITM_NM --아이템명
            ,BRAND_CODE	--브랜드 코드
            ,(SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'BRAND_GROUP_CODE' AND SUB_CODE = BB.BRAND_GROUP_CODE AND USE_AT = 'Y') AS BRAND_GROUP_CODE_NM -- 브랜드 그룹명
            ,(SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'DSTRCT_LCLSF_CODE'  AND SUB_CODE = BB.DSTRCT_LCLSF_CODE) AS DSTRCT_LCLSF_CODE --권역 대분류 코드
            ,BID_WT --수량
            ,PERM_WT_RATE --중량
            ,BDDPR_BEGIN_DT	--투찰 시작 일시
            ,BDDPR_END_DT	--투찰 종료 일시
            ,DSPY_AT	--전시 여부
            ,BB.FRST_REGIST_DT --등록일
            ,BB.FRST_REGISTER_ID --등록자
            ,(SELECT CODE_DCTWO FROM CO_CMMN_CD WHERE MAIN_CODE = 'BID_STTUS_CODE' AND SUB_CODE = BB.BID_STTUS_CODE AND USE_AT = 'Y') AS BID_STTUS
            ,PARTCPTN_ENTRPS_QY	--참여 업체 수량
            ,(
                SELECT ISNULL(MIN(BDDPR_PREMIUM_PC), 0)
                FROM BD_BDDPR_DTL BBD
                WHERE
                    BBD.BID_PBLANC_ID = BB.BID_PBLANC_ID
                    AND CANCL_AT = 'N'
                    AND DELETE_AT = 'N'
            ) AS MIN_PREMIUM_PC --최저프리미엄가
        FROM BD_BID_BAS BB
        where 1=1
        <if test="bidSttusCode != null and bidSttusCode != ''">
            AND BID_STTUS_CODE = #{bidSttusCode}
        </if>
    </select>
    <select id="getBoBdPblnListTotalCnt" resultType="com.m2m.fo.bo.model.BoBdPblnVO">
        SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
        /* com.m2m.fo.bo.mapper.BoBdPblnMapper.getBoBdPblnListTotalCnt */
        SELECT
            COUNT(*) AS TotalCnt
            ,COUNT(CASE WHEN BID_STTUS_CODE=12 THEN 1 END) AS ExpectCnt
            ,COUNT(CASE WHEN BID_STTUS_CODE=13 THEN 1 END) AS BidingCnt
            ,COUNT(CASE WHEN BID_STTUS_CODE=30 THEN 1 END) AS EndCnt
        FROM BD_BID_BAS
    </select>
    <select id="getbidSttusList" parameterType="String" resultType="com.m2m.fo.comm.model.CoCommCdVO">
        SELECT
            MAIN_CODE
            ,SUB_CODE
            ,CODE_NM
            ,CODE_DCTWO
        FROM CO_CMMN_CD
        WHERE
            MAIN_CODE = #{mainCode}
            AND USE_AT = 'Y'
            AND DELETE_AT = 'N'
        ORDER BY CODE_ORDR ASC
    </select>
</mapper>